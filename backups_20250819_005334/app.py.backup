import streamlit as st
import requests

st.set_page_config(page_title="Barn Lady", layout="wide")
st.title("🐴 Barn Lady - Multi-Barn Horse Management")

API_BASE_URL = "http://localhost:8000/api/v1"

if st.button("🚀 Load Your Horses"):
    try:
        response = requests.get(f"{API_BASE_URL}/horses/", timeout=10)
        if response.status_code == 200:
            horses = response.json()
            st.success(f"🐴 Found {len(horses)} horses in your barn!")
            
            for horse in horses:
                col1, col2 = st.columns([3, 1])
                with col1:
                    st.subheader(f"🐴 {horse['name']}")
                    st.write(f"**Breed:** {horse['breed']} | **Age:** {horse['age_display']} | **Color:** {horse['color']}")
                    if horse.get('current_location'):
                        st.write(f"📍 {horse['current_location']}")
                with col2:
                    st.write(f"**Status:** {horse['current_health_status']}")
                st.markdown("---")
            st.balloons()
        else:
            st.error(f"API Error: {response.status_code}")
    except Exception as e:
        st.error(f"Error: {e}")

if st.button("🔍 Test API"):
    try:
        response = requests.get("http://localhost:8000/health", timeout=5)
        if response.status_code == 200:
            st.success("✅ API is healthy!")
        else:
            st.error(f"❌ API returned: {response.status_code}")
    except Exception as e:
        st.error(f"❌ Cannot reach API: {e}")
